@{
    ViewData["Title"] = "Gestión de Colaboradores";
    ViewData["NavbarTitle"] = "Colaboradores";
    ViewData["ActivePage"] = "Colaboradores";
    ViewData["ActiveMenu"] = "Colaboradores"; // o "Vehiculos", "Colaboradores", etc.

    Layout = "_Layout";
}
<div id="colaboradores-app">
    <!-- 1) Encabezado y botón “Agregar” -->
    <div class="row my-4">
        <div class="col-lg-12 d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">Colaboradores</h2>
            <button class="btn btn-primary" v-on:click="mostrarModalCrear">
                <i class="fas fa-plus me-1"></i> Agregar Colaborador
            </button>
        </div>
    </div>

    <!-- 2) Filtros -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form class="row gx-3 gy-2" v-on:submit.prevent="filtrarColaboradores">
                        <!-- Ejemplo: filtro por Departamento -->
                        <div class="col-md-4">
                            <label for="filterDepartamento" class="form-label">Departamento</label>
                            <select id="filterDepartamento" class="form-select" v-model="filtros.departamento">
                                <option value="">Todos</option>
                                <option value="ministerio">Ministerio de Agricultura</option>
                                <option value="salud">Ministerio de Salud</option>
                                <option value="policia">Policía Nacional</option>
                                <option value="defensa">Ministerio de Defensa</option>
                            </select>
                        </div>

                        <!-- Ejemplo: filtro por Estado (Activo / Inactivo) -->
                        <div class="col-md-4">
                            <label for="filterEstado" class="form-label">Estado</label>
                            <select id="filterEstado" class="form-select" v-model="filtros.estado">
                                <option value="">Todos</option>
                                <option value="activo">Activo</option>
                                <option value="inactivo">Inactivo</option>
                            </select>
                        </div>

                        <!-- Botón Filtrar -->
                        <div class="col-md-4 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-filter me-1"></i> Filtrar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 3) Tabla de Colaboradores -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-body">
                    <!-- Estado “cargando” -->
                    <div v-if="cargando" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2 text-muted">Cargando colaboradores...</p>
                    </div>

                    <!-- Si no hay resultados -->
                    <div v-else-if="colaboradores.length === 0" class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No se encontraron colaboradores con los criterios seleccionados.
                    </div>

                    <!-- Tabla propiamente dicha -->
                    <div class="table-responsive" v-else>
                        <table class="table table-hover" id="colaboradoresTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre</th>
                                    <th>Cédula</th>
                                    <th>Departamento</th>
                                    <th>Cargo</th>
                                    <th>Contacto</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(col, index) in colaboradores" :key="col.id">
                                    <td>{{ index + 1 }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img :src="col.imagenUrl || 'https://via.placeholder.com/32'"
                                                 alt="Foto" width="32" height="32" class="rounded-circle me-2">
                                            <div>
                                                <div class="fw-bold">{{ col.nombre }} {{ col.apellido }}</div>
                                                <div class="text-muted small">{{ col.email }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ col.cedula }}</td>
                                    <td>{{ textoDepartamento(col.departamento) }}</td>
                                    <td>{{ col.cargo }}</td>
                                    <td>
                                        <div class="text-muted small">
                                            <i class="bi bi-telephone me-1"></i> {{ col.telefono }}<br>
                                            <i class="bi bi-phone me-1"></i> {{ col.celular }}
                                        </div>
                                    </td>
                                    <td>
                                        <span :class="col.estado === 'activo' ? 'badge bg-success' : 'badge bg-secondary'">
                                            {{ col.estado === 'activo' ? 'Activo' : 'Inactivo' }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex">
                                            <button class="btn btn-sm btn-outline-primary me-1"
                                                    title="Detalles"
                                                    v-on:click="mostrarDetalles(col)">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-warning me-1"
                                                    title="Editar"
                                                    v-on:click="mostrarModalEditar(col)">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                    title="Eliminar"
                                                    v-on:click="eliminarColaborador(col.id)">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4) Modal “Agregar / Editar Colaborador” -->
    <div class="modal fade" id="addColaboradorModal" tabindex="-1" aria-labelledby="addColaboradorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Encabezado -->
                <div class="modal-header text-white bg-primary">
                    <h5 class="modal-title" id="addColaboradorModalLabel">
                        {{ editando ? 'Editar Colaborador' : 'Agregar Nuevo Colaborador' }}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" v-on:click="cerrarModal('addColaboradorModal')" aria-label="Close"></button>
                </div>
                <!-- Cuerpo del Modal -->
                <div class="modal-body">
                    <form id="colaboradorForm" v-on:submit.prevent="guardarColaborador">
                        <ul class="nav nav-tabs mb-3" id="colaboradorTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="info-tab" data-bs-toggle="tab"
                                        data-bs-target="#info" type="button" role="tab"
                                        aria-controls="info" aria-selected="true">
                                    Información
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="laboral-tab" data-bs-toggle="tab"
                                        data-bs-target="#laboral" type="button" role="tab"
                                        aria-controls="laboral" aria-selected="false">
                                    Datos Laborales
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="licencia-tab" data-bs-toggle="tab"
                                        data-bs-target="#licencia" type="button" role="tab"
                                        aria-controls="licencia" aria-selected="false">
                                    Licencia
                                </button>
                            </li>
                        </ul>
                        <div class="tab-content" id="colaboradorTabsContent">
                            <!-- Pestaña “Información” -->
                            <div class="tab-pane fade show active" id="info" role="tabpanel" aria-labelledby="info-tab">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="colaboradorNombre" class="form-label">Nombre *</label>
                                        <input type="text" class="form-control" id="colaboradorNombre"
                                               v-model="colaboradorForm.nombre" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorApellido" class="form-label">Apellido *</label>
                                        <input type="text" class="form-control" id="colaboradorApellido"
                                               v-model="colaboradorForm.apellido" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorCedula" class="form-label">Cédula *</label>
                                        <input type="text" class="form-control" id="colaboradorCedula"
                                               v-model="colaboradorForm.cedula" placeholder="000-0000000-0" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorEmail" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="colaboradorEmail"
                                               v-model="colaboradorForm.email">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorTelefono" class="form-label">Teléfono</label>
                                        <input type="tel" class="form-control" id="colaboradorTelefono"
                                               v-model="colaboradorForm.telefono">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorMovil" class="form-label">Celular</label>
                                        <input type="tel" class="form-control" id="colaboradorMovil"
                                               v-model="colaboradorForm.celular">
                                    </div>
                                    <div class="col-12">
                                        <label for="colaboradorDireccion" class="form-label">Dirección</label>
                                        <textarea class="form-control" id="colaboradorDireccion" rows="2"
                                                  v-model="colaboradorForm.direccion"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Pestaña “Datos Laborales” -->
                            <div class="tab-pane fade" id="laboral" role="tabpanel" aria-labelledby="laboral-tab">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="colaboradorDepartamento" class="form-label">Departamento *</label>
                                        <select class="form-select" id="colaboradorDepartamento"
                                                v-model="colaboradorForm.departamento" required>
                                            <option value="" disabled selected>Seleccione...</option>
                                            <option value="ministerio">Ministerio de Agricultura</option>
                                            <option value="salud">Ministerio de Salud</option>
                                            <option value="policia">Policía Nacional</option>
                                            <option value="defensa">Ministerio de Defensa</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorCargo" class="form-label">Cargo *</label>
                                        <input type="text" class="form-control" id="colaboradorCargo"
                                               v-model="colaboradorForm.cargo" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorNumeroCarnet" class="form-label">N° Carnet</label>
                                        <input type="text" class="form-control" id="colaboradorNumeroCarnet"
                                               v-model="colaboradorForm.numeroCarnet">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorCategoria" class="form-label">Categoría</label>
                                        <select class="form-select" id="colaboradorCategoria"
                                                v-model="colaboradorForm.categoria">
                                            <option value="interno">Interno</option>
                                            <option value="externo">Externo</option>
                                            <option value="militar">Militar</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label for="colaboradorObservaciones" class="form-label">Observaciones</label>
                                        <textarea class="form-control" id="colaboradorObservaciones" rows="2"
                                                  v-model="colaboradorForm.observaciones"></textarea>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="colaboradorActivo"
                                                   v-model="colaboradorForm.estadoBool">
                                            <label class="form-check-label" for="colaboradorActivo">
                                                Colaborador Activo
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pestaña “Licencia” -->
                            <div class="tab-pane fade" id="licencia" role="tabpanel" aria-labelledby="licencia-tab">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="colaboradorLicencia" class="form-label">N° Licencia</label>
                                        <input type="text" class="form-control" id="colaboradorLicencia"
                                               v-model="colaboradorForm.numeroLicencia">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="colaboradorVencimientoLicencia" class="form-label">Vencimiento Licencia</label>
                                        <input type="date" class="form-control" id="colaboradorVencimientoLicencia"
                                               v-model="colaboradorForm.vencimientoLicencia">
                                    </div>
                                    <div class="col-12">
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle me-2"></i>
                                            Esta información sirve para validar si puede asignársele vehículo.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- Pie del Modal -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" v-on:click="cerrarModal('addColaboradorModal')">
                        <i class="fas fa-times me-1"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" v-on:click="guardarColaborador" :disabled="guardando">
                        <span v-if="guardando">
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            Guardando...
                        </span>
                        <span v-else>
                            <i class="fas fa-save me-1"></i> {{ editando ? 'Actualizar' : 'Guardar' }}
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 5) Modal “Detalles del Colaborador” -->
    <div class="modal fade" id="colaboradorDetailsModal" tabindex="-1" aria-labelledby="colaboradorDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <!-- Encabezado -->
                <div class="modal-header text-white bg-primary">
                    <h5 class="modal-title" id="colaboradorDetailsModalLabel">
                        Detalles de {{ colaboradorDetalle.nombre }} {{ colaboradorDetalle.apellido }}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" v-on:click="cerrarModal('colaboradorDetailsModal')" aria-label="Close"></button>
                </div>
                <!-- Cuerpo -->
                <div class="modal-body">
                    <div class="row">
                        <!-- Columna izquierda: foto + info de contacto + licencia -->
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-body text-center">
                                    <img :src="colaboradorDetalle.imagenUrl || 'https://via.placeholder.com/150'"
                                         alt="Foto" class="rounded-circle mb-3" width="120">
                                    <h4 class="mb-1">{{ colaboradorDetalle.nombre }} {{ colaboradorDetalle.apellido }}</h4>
                                    <p class="text-muted mb-3">{{ colaboradorDetalle.cargo }}</p>
                                    <span class="badge"
                                          :class="colaboradorDetalle.estado === 'activo' ? 'bg-success' : 'bg-secondary'">
                                        {{ colaboradorDetalle.estado === 'activo' ? 'Activo' : 'Inactivo' }}
                                    </span>

                                    <div class="mt-4 text-start">
                                        <h6 class="fw-bold">Contacto</h6>
                                        <p class="mb-1"><i class="bi bi-envelope me-2"></i> {{ colaboradorDetalle.email }}</p>
                                        <p class="mb-1"><i class="bi bi-telephone me-2"></i> {{ colaboradorDetalle.telefono }}</p>
                                        <p class="mb-1"><i class="bi bi-phone me-2"></i> {{ colaboradorDetalle.celular }}</p>
                                        <p class="mb-0"><i class="bi bi-geo-alt me-2"></i> {{ colaboradorDetalle.direccion }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="m-0 fw-bold">Licencia</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-sm-5 fw-bold">N° Licencia:</div>
                                        <div class="col-sm-7">{{ colaboradorDetalle.numeroLicencia || 'N/A' }}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-5 fw-bold">Vence:</div>
                                        <div class="col-sm-7">{{ formatearFecha(colaboradorDetalle.vencimientoLicencia) }}</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-5 fw-bold">Estado Vigencia:</div>
                                        <div class="col-sm-7">
                                            <span v-if="colaboradorDetalle.vencimientoLicencia && colaboradorDetalle.vencimientoLicencia >= hoy"
                                                  class="badge bg-success">
                                                Vigente
                                            </span>
                                            <span v-else class="badge bg-danger">
                                                Vencida
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Columna derecha: info laboral y árbol de asignaciones (si aplica) -->
                        <div class="col-md-8">
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h6 class="m-0 fw-bold">Información Laboral</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-sm-3 fw-bold">Cédula:</div>
                                        <div class="col-sm-9">{{ colaboradorDetalle.cedula }}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3 fw-bold">Departamento:</div>
                                        <div class="col-sm-9">{{ textoDepartamento(colaboradorDetalle.departamento) }}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3 fw-bold">Cargo:</div>
                                        <div class="col-sm-9">{{ colaboradorDetalle.cargo }}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3 fw-bold">N° Carnet:</div>
                                        <div class="col-sm-9">{{ colaboradorDetalle.numeroCarnet || 'N/A' }}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3 fw-bold">Categoría:</div>
                                        <div class="col-sm-9">{{ colaboradorDetalle.categoria }}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3 fw-bold">Observaciones:</div>
                                        <div class="col-sm-9">{{ colaboradorDetalle.observaciones || 'Ninguna' }}</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Aquí podrías poner más secciones (por ejemplo, historial de asignaciones, etc.) -->
                        </div>
                    </div>
                </div>
                <!-- Pie del modal -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                            v-on:click="cerrarModal('colaboradorDetailsModal')">
                        <i class="fas fa-times me-1"></i> Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Dependencias CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="~/js/colaboradores.js"></script>

}